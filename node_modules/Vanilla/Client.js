window.onload = () => {
    for (const view of document.getElementsByTagName("View")) {
        LoadView(view.getAttribute("src"), view);
    }

    // Monitor DOM changes
    const observer = new MutationObserver(() => onChange());

    observer.observe(document.body, {
        childList: true, // Detect added or removed elements
        subtree: true,   // Monitor the whole DOM tree
    });
};

function onChange() {
    for (const view of document.getElementsByTagName("View")) {
        if (view.hasAttribute("src")) {
            LoadView(view.getAttribute("src"), view);
        }
    }
}

function LoadView(view, element) {
    fetch("/Vanilla/Views/" + view)
        .then(response => response.text())
        .then(data => {
            element.replaceWith(new DOMParser().parseFromString(data, "text/html").body.firstElementChild);
        });
}
